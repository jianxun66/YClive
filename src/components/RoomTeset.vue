<template>
    <div class="live-index">
      <div class="header" id="top">
        <div class="search-bar">
          <div class="user-head"></div>
          <div class="live-search-box">
            <div class="search-box">
              <i class="live-search-icon"></i>
              <input class="search-input" placeholder="刘老头米店"/>
              <i class="live-search-next"></i>
            </div>
          </div>
          <div class="yclive-home"></div>
        </div>
        <div class="live-menu-bar">
          <div class="swiper-container" id="nav">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <span class="active">推荐</span>
              </div>
              <div class="swiper-slide">
                <span>全部</span>
              </div>
              <div class="swiper-slide">
                <span>猪场</span>
              </div>

              <div class="swiper-slide">
                <span>鹿场</span>
              </div>

              <div class="swiper-slide">
                <span>茶园</span>
              </div>

              <div class="swiper-slide">
                <span>菜园</span>
              </div>

              <div class="swiper-slide">
                <span>药材基地</span>
              </div>
              <div class="bar">
                <div class="color"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="live-header-bg"></div>
      </div>
      <div class="live-main swiper-container" id="page">
        <div class="swiper-wrapper">
          <div class="swiper-slide slidepage">
            <div class="swiper-container scroll">
              <div class="swiper-wrapper">
                <div class="swiper-slide slidescroll">
                  <!--轮播图-->
                  <div class="swiper-container banner">
                    <div class="swiper-wrapper">
                      <div class="swiper-slide">
                        <img src="../../static/uploads/banner1.jpg"></div>
                      <div class="swiper-slide">
                        <img src="../../static/uploads/banner2.jpg"></div>
                      <div class="swiper-slide">
                        <img src="../../static/uploads/banner3.jpg"></div>
                    </div>
                    <div class="swiper-pagination"></div>
                  </div>
                  <!--轮播图-->

                  <!--活动通知-->
                  <div class="live-activity">
                    <div class="live-activity-head">活动</div>
                    <div class="live-activity-box">
                      <div class="live-activity-content">
                        <div class="live-activity-title">
                          雪地狂奔跑的藏香猪直播
                        </div>
                        <div>
                          <span class="live-activity-date">1月08日</span>
                          <span class="live-activity-time">19:00</span>
                          <span class="live-color">开始热播</span>
                        </div>
                      </div>
                    </div>
                    <div class="live-activity-btn">围观</div>
                  </div>
                  <!--活动通知-->

                  <!--列表标题-->
                  <div class="live-lists-head">
                    热点推荐
                  </div>
                  <!--列表标题-->

                  <!--直播列表-->
                  <div class="live-lists-content">
                    <ul class="live-items">
                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>

                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>


                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>


                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>

                    </ul>
                  </div>
                  <!--直播列表-->
                </div>
              </div>
            </div>
          </div>
          <!--第二页面-->
          <div class="swiper-slide slidepage">
            <div class="swiper-container scroll">
              <div class="swiper-wrapper">
                <div class="swiper-slide slidescroll">
                  <div class="live-lists-content">
                    <ul class="live-items live-items-all">
                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>

                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>


                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>


                      <li class="live-item">
                        <div class="live-item-show">
                          <img src="../../static/images/live.png"/>
                        </div>
                        <div class="live-item-des">
                          <div class="live-item-info">
                            <div class="live-item-title">
                              好汉鹿场基地
                            </div>
                            <div class="live-item-intro">
                              生态放养优质鹿场
                            </div>
                          </div>
                          <span class="live-item-view">123456</span>
                        </div>
                      </li>

                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="live-banner" id="live-banner">

        </div>
      </div>
      <div class="footer">
        <div class="item">
          <div class="live-foot-live">
            <div class="active">
              <div class="item-icon"></div>
              <div class="item-text">视频现场</div>
            </div>
          </div>
        </div>
        <div class="item">
          <div class="live-foot-video">
            <div >
              <div class="item-icon"></div>
              <div class="item-text">精彩短片</div>
            </div>
          </div>
        </div>

        <div class="item">
          <div class="live-foot-user">
            <div >
              <div class="item-icon"></div>
              <div class="item-text">个人中心</div>
            </div>
          </div>
        </div>

      </div>

    </div>
</template>

<script>
    export default {
        name: "RoomTeset",
      mounted(){
        var tSpeed = 300;
        var navSlideWidth;
        var bar, navSum, clientWidth, navWidth, progress, startPosition , sc;
        var topBar;
        var navSwiper = new Swiper('#nav', {
          slidesPerView: 5,
          freeMode: true,
          on: {
            init: function() {
              navSlideWidth = this.slides.eq(0).css('width'); //导航字数需要统一,每个导航宽度一致
              bar = this.$el.find('.bar')
              bar.css('width', navSlideWidth)
              bar.transition(tSpeed)
              navSum = this.slides[this.slides.length - 1].offsetLeft //最后一个slide的位置

              clientWidth = parseInt(this.$wrapperEl.css('width')) //Nav的可视宽度
              navWidth = 0
              for (var i = 0; i < this.slides.length; i++) {
                navWidth += parseInt(this.slides.eq(i).css('width'))
              }



            },

          },
        });

        var pageSwiper = new Swiper('#page', {
          watchSlidesProgress: true,
          resistanceRatio: 0,
          on: {
            touchMove: function() {
              progress = this.progress
              bar.transition(0)
              bar.transform('translateX(' + navSum * progress + 'px)')
              //粉色255,72,145灰色51,51,51
              for (i = 0; i < this.slides.length; i++) {
                slideProgress = this.slides[i].progress
                if (Math.abs(slideProgress) < 1) {
                  r = Math.floor((255 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                  g = Math.floor((72 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                  b = Math.floor((145 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                  //navSwiper.slides.eq(i).find('span').css('color', 'rgba(' + r + ',' + g + ',' + b + ',1)')
                  navSwiper.slides.eq(i).find('span').css('font-size', '1.2rem')
                }
              }
            },
            transitionStart: function() {
              activeIndex = this.activeIndex
              activeSlidePosition = navSwiper.slides[activeIndex].offsetLeft
              //释放时导航粉色条移动过渡
              bar.transition(tSpeed)
              bar.transform('translateX(' + activeSlidePosition + 'px)')
              //释放时文字变色过渡
              navSwiper.slides.eq(activeIndex).find('span').transition(tSpeed)
              navSwiper.slides.eq(activeIndex).find('span').css('font-size', '1.2rem')
              if (activeIndex > 0) {
                navSwiper.slides.eq(activeIndex - 1).find('span').transition(tSpeed)
                navSwiper.slides.eq(activeIndex - 1).find('span').css('font-size', '1rem')
              }
              if (activeIndex < this.slides.length) {
                navSwiper.slides.eq(activeIndex + 1).find('span').transition(tSpeed)
                navSwiper.slides.eq(activeIndex + 1).find('span').css('font-size', '1rem')
              }
              //导航居中
              navActiveSlideLeft = navSwiper.slides[activeIndex].offsetLeft //activeSlide距左边的距离

              navSwiper.setTransition(tSpeed)
              if (navActiveSlideLeft < (clientWidth - parseInt(navSlideWidth)) / 2) {
                navSwiper.setTranslate(0)
              } else if (navActiveSlideLeft > navWidth - (parseInt(navSlideWidth) + clientWidth) / 2) {
                navSwiper.setTranslate(clientWidth - navWidth)
              } else {
                navSwiper.setTranslate((clientWidth - parseInt(navSlideWidth)) / 2 - navActiveSlideLeft)
              }

            },
          }
        });


        //内容滚动
        var scrollSwiper = new Swiper('.scroll', {
          //65是头部的高
          //56是top地址和搜索的高

          slidesOffsetBefore: 100,
          direction: 'vertical',
          freeMode: true,
          slidesPerView: 'auto',

          mousewheel: {
            releaseOnEdges: true,
          },
          on: {
            touchMove: function() {

              if (this.translate > 100 - 50 && this.translate < 100) {
                topBar.transform('translateY(' + (this.translate - 100) + 'px)');
              }

            },
            touchStart: function() {
              startPosition = this.translate
            },
            touchEnd: function() {
              topBar.transition(tSpeed)
              if (this.translate > 50 && this.translate < 100 && this.translate < startPosition) {
                topBar.transform('translateY(-56px)');
                for (sc = 0; sc < scrollSwiper.length; sc++) {
                  if (scrollSwiper[sc].translate > 50) {
                    scrollSwiper[sc].setTransition(tSpeed);
                    scrollSwiper[sc].setTranslate(50)
                  }
                }
              }
              if (this.translate > 50 && this.translate < 100 && this.translate > startPosition) {
                topBar.transform('translateY(0px)');
                for (sc = 0; sc < scrollSwiper.length; sc++) {
                  if (scrollSwiper[sc].translate < 100 && scrollSwiper[sc].translate > 0) {
                    scrollSwiper[sc].setTransition(tSpeed);
                    scrollSwiper[sc].setTranslate(100)
                  }
                }
              }
            },

            transitionStart: function() {
              topBar = this.$el.parents('body').find('#top') //页头
              topBar.transition(tSpeed)
              if (this.translate < 100 - 50) {
                topBar.transform('translateY(-56px)');
                if (scrollSwiper) {
                  for (sc = 0; sc < scrollSwiper.length; sc++) {
                    if (scrollSwiper[sc].translate > 50) {
                      scrollSwiper[sc].setTransition(tSpeed);
                      scrollSwiper[sc].setTranslate(50)
                    }
                  }
                }

              } else {
                topBar.transform('translateY(0px)');

                if (scrollSwiper) {
                  for (sc = 0; sc < scrollSwiper.length; sc++) {
                    if (scrollSwiper[sc].translate < 100 && scrollSwiper[sc].translate > 0) {
                      scrollSwiper[sc].setTransition(tSpeed);
                      scrollSwiper[sc].setTranslate(100)
                    }
                  }
                }
              }
            },
          }

        })

        //热卖
        var bannerSwiper = new Swiper('.banner', {
          loop: true,
          pagination: {
            el: '.swiper-pagination',
            type: 'bullets',
            bulletActiveClass: 'live-banner-active',
          },
          autoplay: {
            delay: 3000,
            stopOnLastSlide: false,
            disableOnInteraction: true,
          },
        });
      }
    }
</script>

<style scoped>

</style>
